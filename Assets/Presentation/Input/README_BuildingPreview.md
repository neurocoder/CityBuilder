# Building Preview System

## Описание
Система предварительного просмотра зданий заменяет старый TileSelector и показывает визуальный индикатор при наведении мыши на клетки сетки. Индикатор меняет цвет в зависимости от доступности клетки:
- **Зеленый** - клетка доступна для строительства
- **Красный** - клетка занята или недостаточно ресурсов

## Компоненты

### BuildingPreviewController
- Управляет отображением предварительного просмотра зданий
- Проверяет доступность клетки в реальном времени
- Меняет цвет индикатора в зависимости от состояния

### InputController (обновлен)
- Интегрирован с BuildingPreviewController
- Обновляет предварительный просмотр при движении мыши
- Скрывает предварительный просмотр в режиме перемещения зданий

## Настройка в Unity

### 1. Создание префаба предварительного просмотра
1. Создайте новый GameObject в сцене
2. Добавьте компонент SpriteRenderer
3. Настройте спрайт (можно использовать белый квадрат)
4. Установите Sorting Order: 100 (чтобы отображался поверх зданий)
5. Сохраните как префаб: `Assets/Content/Prefabs/BuildingPreview.prefab`

### 2. Настройка BuildingPreviewController
1. Создайте новый GameObject в сцене (например, "BuildingPreviewController")
2. Добавьте компонент BuildingPreviewController
3. В поле "Preview Prefab" перетащите созданный префаб BuildingPreview
4. Настройте цвета:
   - Valid Color: зеленый (0, 1, 0, 1)
   - Invalid Color: красный (1, 0, 0, 1)
   - Preview Alpha: 0.5 (полупрозрачность)
5. Настройте Sorting Order:
   - Sorting Order: 100 (чтобы индикатор был на переднем плане)

### 3. Настройка InputController
1. Выберите GameObject с компонентом InputController
2. В инспекторе найдите поле "Preview Controller" (старое поле "Tile Selector" больше не используется)
3. Перетащите BuildingPreviewController в это поле

### 4. Настройка PresentationInstaller
1. Выберите GameObject с компонентом PresentationInstaller
2. В инспекторе найдите поле "Building Preview Controller"
3. Перетащите BuildingPreviewController в это поле

### 5. Проверка настройки
После настройки система должна работать без ошибок. Если возникают проблемы:
- Убедитесь, что BuildingPreviewController назначен в PresentationInstaller
- Убедитесь, что BuildingPreviewController назначен в InputController
- Убедитесь, что префаб BuildingPreview имеет компонент SpriteRenderer

### 6. Настройка порядка отображения
Если индикатор все еще перекрывается зданиями:
- Увеличьте значение "Sorting Order" в BuildingPreviewController (например, до 200)
- Или уменьшите Sorting Order зданий в их префабах

## Логика работы

1. При выборе типа здания (клавиши 1, 2, 3) активируется предварительный просмотр
2. При движении мыши по сетке обновляется позиция и цвет индикатора
3. Система проверяет:
   - Свободна ли клетка (через IGridService)
   - Достаточно ли ресурсов (через IResourceRepository)
4. В режиме перемещения зданий (клавиша M) предварительный просмотр также активен:
   - Показывает доступность клетки для переноса
   - Не проверяет ресурсы (перенос бесплатный)
   - Зеленый индикатор = можно перенести, красный = клетка занята

## Интеграция с DI
BuildingPreviewController автоматически получает зависимости через VContainer:
- IGridService - для проверки доступности клеток
- IResourceRepository - для проверки ресурсов

## Расширение функциональности
Для добавления новых типов зданий:
1. Обновите enum BuildingType
2. Добавьте правила в UpgradeRules
3. Система автоматически будет работать с новыми типами

## Логи
Система выводит только важные логи:
- Смена режима переноса зданий
- Сохранение игры
